<!--- Project Valyrian --->
<!--- Version 0.1 Beta --->
<!--- By EtoileLion --->
<!--- Song of Ice and Fire, Game of Thrones, and all associated copyrights and trademarks belong to their respective authors. --->
<!--- Released under MIT License for use with Roll20 --->
<!--- External Font purchased from Blambot and is not licensed for use outside of this sheet. --->
<input type='hidden' name='attr_charpage' class='sheet-charpage'>
<div class='sheet-page1'>
	<input name='attr_character_name' class='sheet-charname'>
			<div class='sheet-pagetogglediv'>	
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage'  type='radio' value="1" checked>
				<span class="sheet-pfradio">H
				</span>
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="2" >
				<span class="sheet-pfradio">i
				</span>		
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="3" >
				<span class="sheet-pfradio">y
				</span>		
			</label>			
		</div>
	<div class='sheet-header'>
		<label class='sheet-age-label sheet-mainlabel' data-i18n='age'>Age</label>
		<input type='number' name='attr_age' min=0 value=0>
		<label class='sheet-gender-label sheet-mainlabel' data-i18n='gender'>Gender</label>
		<input type='text' name='attr_gender' class='sheet-flexthis'>
		<label class='sheet-house-label sheet-mainlabel' data-i18n='house'>House</label>
		<input type='text' name='attr_house' class='sheet-flexthis'>
	</div>
	<label class='sheet-abilities-label sheet-mainlabel' data-i18n='abilities'>Abilities</label>
	<div class='sheet-2colrow'>
		<div class='sheet-col'>			
			<table class='sheet-abilities-table'>
				<tr class='row-header'>
					<th class='sheet-rating-label sheet-mainlabel' data-i18n='rating'>Rating</th>
					<th class='sheet-ability-label sheet-mainlabel' data-i18n='ability'>Ability</th>
					<th class='sheet-specialties-label sheet-mainlabel' data-i18n='specialities'>Specialities</th>
				</tr>
				<tr class='sheet-ability-row'>
					<td><input type='number' min=0 max=10 value=2 name='attr_agility_rating'></td>
					<td><button class='sheet-agility-label' data-i18n='agility'></button></td>
					<td class='sheet-specs sheet-agility-specs'>
					    <div>
							<input class="sheet-options-flag" type="checkbox" name="attr_hidden_agility">
						</div>
						<span id='spanout_agility'>
							<input type='hidden' name='attr_acrobatics_rating'>
							<button class='sheet-spec-button' type='roll' value='&{template:iafroll} {{type=Agility+Acrobatics}} {{result=[[(@{agility_rating}+@{acrobatics_rating})d6dl@{acrobatics_rating}]]}}'>Acrobatics <span name='attr_acrobatics_rating'></span>B</button>
							<input type='hidden' name='attr_balance_rating'>
							<button class='sheet-spec-button' type='roll' value='&{template:iafroll} {{type=Agility+Balance}} {{result=[[(@{agility_rating}+@{balance_rating})d6dl@{balance_rating}]]}}'>Balance <span name='attr_balance_rating'></span>B</button>
							<input type='hidden' name='attr_contortions_rating'>
							<button class='sheet-spec-button' type='roll' value='&{template:iafroll} {{type=Agility+Contortions}} {{result=[[(@{agility_rating}+@{contortions_rating})d6dl@{contortions_rating}]]}}'>Contortions <span name='attr_contortions_rating'></span>B</button>
							<input type='hidden' name='attr_dodge_rating'>
							<button class='sheet-spec-button' type='roll' value='&{template:iafroll} {{type=Agility+Dodge}} {{result=[[(@{agility_rating}+@{dodge_rating})d6dl@{dodge_rating}]]}}'>Dodge <span name='attr_dodge_rating'></span>B</button>
							<input type='hidden' name='attr_quickness_rating'>
							<button class='sheet-spec-button' type='roll' value='&{template:iafroll} {{type=Agility+Quickness}} {{result=[[(@{agility_rating}+@{quickness_rating})d6dl@{quickness_rating}]]}}'>Quickness <span name='attr_quickness_rating'></span>B</button>							
						</span>
					</td>								
				</tr>								
				<tr>
					<td class='sheet-specialities-td' colspan='3'>
					<input type='hidden' name='attr_hidden_agility' class='sheet-hide-specs'>
					<div class='sheet-specialities-tr'>
						<fieldset class='repeating_agility'>
							<div class="sheet-flex-box">
								<input type="number" name='attr_spec_rating' min="1" value="1">
								<select name="attr_spec_name" class="sheet-flexthis">
									<option value='acrobatics'>Acrobatics</option>
									<option value='balance'>Balance</option>
									<option value='contortions'>Contortions</option>
									<option value='dodge'>Dodge</option>
									<option value='quickness'>Quickness</option>
								</select>					
							</div>
						</fieldset>						
					</div>
					</td>
				</tr>
			</table>
		</div>
		<div class='sheet-col'>
			<!--Right Abilities Column --->
		</div>
	</div>
	<div class='sheet-2colrow'>
		<div class='sheet-col'>
			<label class='sheet-qualities-label sheet-mainlabel' data-i18n='qualities'>Qualities</label>
			<textarea name='attr_qualities'></textarea><!-- TODO: Investigate Qualities. -->
			<div class='sheet-flex-box'>
			<label class='sheet-destinypoints-label sheet-mainlabel' data-i18n='destiny'>Destiny Points</label>
			<div class='sheet-destinypoints'>
				<input type='checkbox' name='attr_destiny_1'>
				<input type='checkbox' name='attr_destiny_2'>
				<input type='checkbox' name='attr_destiny_3'>
				<input type='checkbox' name='attr_destiny_4'>
				<input type='checkbox' name='attr_destiny_5'>
				<input type='checkbox' name='attr_destiny_6'>
				<input type='checkbox' name='attr_destiny_7'>
				<input type='checkbox' name='attr_destiny_8'>
			</div>
			</div>
		</div>
		<div class='sheet-col sheet-2colrow'>
			<div class='sheet-col'>
				<label class='sheet-intrigue-label sheet-mainlabel sheet-nopadding' data-i18n='intrigue'>Intrigue</label>
				<label class='sheet-intriguedefense-label' data-i18n='intriguedef'>Intrigue Defense</label>
				<input type='number' value='@{agility_rating}+@{cunning_rating}+@{status_rating}' disabled="true">
				<label class='sheet-composure-label' data-i18n='composure'>Composure</label>
				<input type='number' value='@{will_rating}*3' disabled="true">
			</div>
			<div class='sheet-col'>
				<label class='sheet-combat-label sheet-mainlabel sheet-nopadding' data-i18n='combat'>Combat</label>
				<label class='sheet-combatdefense-label' data-i18n='combatdef'>Combat Defense</label>
				<input type='number' value='@{agility_rating}+@{athletics_rating}+@{awareness_rating}+@{defensive_bonus}-@{armor_penalty}' disabled="true">
				<label class='sheet-health-label' data-i18n='health'>Health</label>
				<input type='number' value='@{endurance_rating}*3' disabled="true">				
			</div>
		</div>
	</div>
	<div class='sheet-2and1 sheet-row sheet-flex-box'>
		<div class='sheet-leftcol'>
			<label class='sheet-weapons-label sheet-mainlabel sheet-nopadding' data-i18n='weapons'>Weapons</label>
			<div class='sheet-flex-box'>
			<label class='sheet-attack-label sheet-mainlabel' data-i18n='attack'>Attack</label>
			<label class='sheet-testdice-label sheet-mainlabel' data-i18n='testdice'>Test Dice</label>
			<label class='sheet-weapondamage-label sheet-mainlabel' data-i18n='Weapon Damage'>Weapon Damage</label>
			</div>
			<fieldset class='repeating_attacks'>
				<!-- Attacks -->
				<div class='sheet-flex-box'>
				<input type='text' name='attr_attack_name' class='sheet-flexthis'>
				<input type='number' name='attr_dice'>
				<input type='text' name='attr_attack_damage' class='sheet-flexthis'>
				</div>
			</fieldset>
		</div>
		<div class='sheet-rightcol'>
			<label class='sheet-armor-label sheet-mainlabel sheet-nopadding' data-i18n='armor'>Armor</label>
			<textarea name='attr_armor' class="sheet-textareafullsize"></textarea>
			<label class='sheet-armorrating-label sheet-mainlabel  sheet-nopadding' data-i18n='armorrating'>Armor Rating</label>
			<input type='number' min="0" name='attr_armor_rating' value="0">
			<label class='sheet-armorpenalty-label sheet-mainlabel sheet-nopadding' data-i18n='armorpenalty'>Armor Penalty</label>
			</div>
	</div>
	<div class='sheet-flex-box'>
	<label class='sheet-damage-label sheet-mainlabel ' data-i18n='damage'>Damage</label>
	<div class='sheet-flexthis'><!--TODO : Health = END * 3 -->
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_1'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_2'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_3'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_4'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_5'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_6'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_7'><br>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_8'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_9'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_10'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_11'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_12'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_13'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_14'><br>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_15'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_16'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_17'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_18'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_19'>		   
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_20'>
		<input type='checkbox' class='sheet-dmgbox' name='attr_damage_21'>		   
	</div>
	<label class='sheet-injuries-label sheet-mainlabel' data-i18n='injuries'>Injuries</label>
	<div class='sheet-flexthis'><!--TODO: Injuries = END -->
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_1'>
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_2'>
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_3'>			
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_4'>
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_5'>
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_6'>
		<input type='checkbox' class='sheet-injurybox' name='attr_injury_7'>
	</div>
	<label class='sheet-wounds-label sheet-mainlabel' data-i18n='wounds'>Wounds</label>
	<div class='sheet-flexthis'><!--TODO: Wounds = END -->
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_1'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_2'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_3'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_4'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_5'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_6'>
		<input type='checkbox' class='sheet-woundbox' name='attr_wounds_7'>		
	</div>
	</div>
</div>
<div class='sheet-page2'>
			<input name='attr_character_name' class='sheet-charname'>	
			<div class='sheet-pagetogglediv'>	
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage'  type='radio' value="1" checked>
				<span class="sheet-pfradio">H
				</span>
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="2" >
				<span class="sheet-pfradio">i
				</span>		
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="3" >
				<span class="sheet-pfradio">y
				</span>		
			</label>			
		</div>
	<div class='sheet-2colrow'>
		<div class='sheet-col'>
			<label class='sheet-equipment-label sheet-mainlabel sheet-nopadding'>Equipment</label>
			<textarea name='attr_equipment' class="sheet-textareafullsize"></textarea>
			<label class='sheet-retainers-label sheet-mainlabel sheet-nopadding'>Retainers</label>
			<textarea name='attr_retainers' class="sheet-textareafullsize"></textarea>			
		</div>
		<div class='sheet-col'>
			<label class='sheet-appearance-label sheet-mainlabel sheet-nopadding'>Appearance</label>
			<div class='sheet-2colrow'>
				<div class='sheet-col'>
					<label class='sheet-height-label sheet-nopadding'>Height</label><input type='text' name='attr_height'>
					<label class='sheet-eyecolor-label sheet-nopadding'>Eye Color</label><input type='text' name='attr_eye_color'>		
				</div>
				<div class='sheet-col'>
					<label class='sheet-weight-label sheet-nopadding'>Weight</label><input type='text' name='attr_weight'>
					<label class='sheet-haircolor-label sheet-nopadding'>Hair Color</label><input type='text' name='attr_hair_color'>		
				</div>
			</div>
			<label class='sheet-mannerisms-label sheet-mainlabel sheet-nopadding'>Mannerisms</label>
			<textarea name='attr_mannerisms' class="sheet-textareafullsize"></textarea>
			<label class='sheet-features-label sheet-mainlabel sheet-nopadding'>Features</label>
			<textarea name='attr_features' class="sheet-textareafullsize"></textarea>
		</div>		
	</div>
	<label class='sheet-personalhistory-label sheet-mainlabel sheet-nopadding'>Personal History</label>
	<textarea name='attr_personal_history' class="sheet-textareafullsize"></textarea>
	<div class='sheet-3colrow'>
		<div class='sheet-col'>
			<label class='sheet-allies-label sheet-mainlabel sheet-nopadding'>Allies</label>
			<textarea name='attr_allies' class="sheet-textareafullsize"></textarea>
			<label class='sheet-heraldry-label sheet-mainlabel sheet-nopadding'>Heraldry</label>
			<textarea name='attr_heraldry' class="sheet-textareafullsize"></textarea>
		</div>
		<div class='sheet-col'>
			<label class='sheet-enemies-label sheet-mainlabel sheet-nopadding'>Enemies</label>
			<textarea name='attr_enemies' class="sheet-textareafullsize"></textarea>
			<label class='sheet-portrait-label sheet-mainlabel sheet-nopadding'>Portrait</label>
			<textarea name='attr_portrait' class="sheet-textareafullsize"></textarea>		
		</div>
		<div class='sheet-col'>
			<label class='sheet-oaths-label sheet-mainlabel sheet-nopadding'>Oaths</label>
			<textarea name='attr_oaths' class="sheet-textareafullsize"></textarea>
			<label class='sheet-motto-label sheet-mainlabel sheet-nopadding'>Motto</label>
			<textarea name='attr_motto' class="sheet-textareafullsize"></textarea>		
		</div>		
	</div>
</div>
<div class='sheet-page3'>
	<input name='attr_character_name' class='sheet-charname'>
			<div class='sheet-pagetogglediv'>	
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage'  type='radio' value="1" checked>
				<span class="sheet-pfradio">H
				</span>
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="2" >
				<span class="sheet-pfradio">i
				</span>		
			</label>
			<label class='sheet-pfcontainer'>
				<input name='attr_charpage' type='radio' value="3" >
				<span class="sheet-pfradio">y
				</span>		
			</label>			
		</div>
		<div class='sheet-row'>
		<label class='sheet-mainlabel sheet-nopadding'>Notes</label>
		<textarea name='attr_notes' class="sheet-textareafullsize"></textarea>
		(More to come here...)
		</div>
</div>

<rolltemplate class="sheet-rolltemplate-cinac">
	<table>
		<tr><th colspan='2'>Character In A Can</th></tr>
		<tr><th>Age</th><td>{{age}}</td></tr>
		<tr><th>Status</th><td>{{status}}</td></tr>
		<tr><th>Background Event</th><td>{{background}}</td></tr>
		<tr><th>Goals</th><td>{{goal}}</td></tr>
		<tr><th>Motivation</th><td>{{motive}}</td></tr>
		<tr><th>Virtue</th><td>{{virtue}}</td></tr>
		<tr><th>Vice</th><td>{{vice}}</td></tr>
	</table>
</rolltemplate>

<script type='text/worker'>
	"use strict";
	
	on("change:repeating_agility", function(eventInfo) {
		let out = {};
		let changedgroup = eventInfo.sourceAttribute.split("_")[1];
		console.log("DEBUG: "+changedgroup);
		getSectionIDs("repeating_"+changedgroup,function(idarray) {
			console.log(idarray);
			idarray = idarray.map(function(x) { return "repeating_"+changedgroup+x; });
			let idarray2 = [...idarray];
			idarray = idarray.map(function(x) { return x+"_spec_name"; });
			idarray2 = idarray2.map(function(x) { return x+"_spec_rating"; });
			console.log([...idarray,...idarray2]);
			getAttrs([...idarray,...idarray2], function(values) {
				console.log(values);
				idarray2.forEach(function(id) {
					out[values["repeating_"+changedgroup+id+"_spec_name"]+"_rating"] = values["repeating_"+changedgroup+id+"_spec_rating"];
				});
				console.log(out);
				setAttrs(out);
			});			
		});
	});
</script>
